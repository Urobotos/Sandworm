
################################################################
# BIGTREETECH MINI 12864 V2.0 LCD (EXP1 / EXP2) pins Aliases:
################################################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PE8, EXP1_2=PE7,
    EXP1_3=PE9, EXP1_4=PE10,
    EXP1_5=PE12, EXP1_6=PE13,    # Slot in the socket on this side
    EXP1_7=PE14, EXP1_8=PE15,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PB1, EXP2_4=PA4,
    EXP2_5=PB2, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PC15, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=PC5


#####################################################################
#   Display Bigtreetech Mini 12864 V2.0
#####################################################################

[display]
lcd_type: uc1701
cs_pin: EXP1_3
a0_pin: EXP1_4
rst_pin: EXP1_5
encoder_pins: ^EXP2_5, ^EXP2_3
click_pin: ^!EXP1_2
contrast: 63
spi_software_miso_pin: EXP2_1
spi_software_mosi_pin: EXP2_6
spi_software_sclk_pin: EXP2_2
menu_root: __content
menu_timeout: 40

## Display Beeper settings:
[pwm_cycle_time beeper]
pin: EXP1_1
value: 0
shutdown_value: 0
cycle_time: 0.001                                                             # Default PWM frequency : 0.001 = 1ms will give a tone of 1kHz


#####################################################################
#   Macros:
#####################################################################

## M300 macro:
## Example of gcode usage: M300 S440 P300 D0
## S the tone frequency (Hz), P is the tone duration (ms), D is the delay (in ms) after the tone is played (For no delay: Do not set D, or set D=0).
[gcode_macro M300]
gcode:
   {% set frequency = params.S | default(1000) |int %}                         # Default 1 kHz tone.
   {% set duration = params.P | default(100) | int %}                          # Default 10ms duration.
   {% set delay = params.D | default(0) | int %}                               # Default 0ms delay after the tone is played.
   {% set pwm = 1.0/frequency if frequency > 0 else 1 %}   
   SET_PIN PIN=beeper VALUE=0.3 CYCLE_TIME={ pwm }
   G4 P{duration}
   SET_PIN PIN=beeper VALUE=0
   G4 P{delay}

## Macro tone for alert beep:
[gcode_macro alert_beep]
gcode:	
   M300 S880 P100 D0        # First double beep
   M300 S880 P100 D500      # Delay: 500ms
   M300 S880 P100 D0        # Second double beep
   M300 S880 P100 D500      # Delay: 500ms
   M300 S880 P100 D0        # Third double beep
   M300 S880 P100 D0        # Delay: 0ms

## To change the language using the LCD menu:
## 1 = English, 2 = Czech, 3 = German
[gcode_macro SET_MENU_LANGUAGE]
description: LCD menu language
gcode:
    {% set lang = params.LANGUAGE | default(1) | int %}
    {% set messages = {
        1: "English selected",
        2: "Zvolena cestina",
        3: "Deutsch ausgewahlt" } %}
    SAVE_VARIABLE VARIABLE=lang VALUE={ lang }
    M117 { messages.get(lang, "Language set") }

## Knob LED feedback ON-OFF:
## 1 = feedback ON, 0 = feedback OFF
[gcode_macro knob_feedback]
description: Knob LED feedback when gcode macro is triggered via LCD menu.
gcode:
    {% set value_knob = printer.save_variables.variables.display_knob %}
    {% if value_knob == 1 %}
       SET_LED LED=display RED=0 GREEN=1 BLUE=0 INDEX=1 TRANSMIT=1 SKIP=1
       UPDATE_DELAYED_GCODE ID=knob_return DURATION=0.5
    {% endif %} 

[delayed_gcode knob_return]
initial_duration: 0
gcode:
   {% set red = printer.save_variables.variables.display_red | default(0.02) | float | round(3) %}                      
   {% set green = printer.save_variables.variables.display_green | default(0.05) | float | round(3) %}
   {% set blue = printer.save_variables.variables.display_blue | default(0.1) | float | round(3) %}
   SET_LED LED=display RED={red} GREEN={green} BLUE={blue} INDEX=1 TRANSMIT=1 SKIP=1


################################################################
# LCD menu:
################################################################
# Gcode for exit after command - { menu.exit() }
# Gcode for back after command - {menu.back()}

### Offer structure (English version) ###
# Content:
#   + Adjust print
#       + Ex0:000 (0000)
#       + Bed:000 (0000)
#       + Speed: 000%
#       + Flow: 000%
#       + Offset Z:00.00
#       + Fan speed
#   + SD print
#       + Start printing
#       + Resume printing            
#       + Pause printing             
#       + Cancel printing            
#       + ... (files)
#   + Control
#       + Move XYZ,E
#         + Move 10mm
#             + Move X:000.0
#             + Move Y:000.0
#             + Move Z:000.0
#             + Move E:+000.0
#         + Move 1mm
#             + Move X:000.0
#             + Move Y:000.0
#             + Move Z:000.0
#             + Move E:+000.0
#         + Move 0.1mm
#             + Move X:000.0
#             + Move Y:000.0
#             + Move Z:000.0
#             + Move E:+000.0
#       + Home All
#       + Home X/Y
#       + Home Z
#       + Park toolhead
#       + Steppers off
#       + E Stepper off
#       + Fan: OFF
#       + Fan speed: 000%
#   + Temperature
#       + Ex0:000 (0000)
#       + Bed:000 (0000)
#       + Preheat PLA
#           + Preheat all
#           + Preheat hotend
#           + Preheat hotbed
#       + Preheat PETG
#           + Preheat all
#           + Preheat hotend
#           + Preheat hotbed
#       + Preheat ABS
#           + Preheat all
#           + Preheat hotend
#           + Preheat hotbed
#       + Preheat PROBE
#           + Preheat all
#           + Preheat hotend
#           + Preheat hotbed
#       + Cooldown
#           + Cooldown all
#           + HotEnd off
#           + HotBed off
#   + Filament
#       + Ex0:000 (0000)
#       + Load Fil.
#           + Load PLA
#           + Load PETG
#           + Load ABS
#       + Unload Fil.
#           + Unload PLA
#           + Unload PETG
#           + Unload ABS   
#       + Change Fil.
#           + Change PLA
#           + Change PETG
#           + Change ABS
#       + Move E: 000.0 mm
#       + E Stepper off
#   + Lights
#       + lights: ON/OFF
#       + Bright: 0.3
#       + lights on max.
#       + Nozzle: ON/OFF
#       + Red: 0.30
#       + Green: 0.30
#       + Blue: 0.30
#   + Chamber
#       + Current: <temperature>
#       + Cool at: 35Â°C
#   + Setup
#       + Power Management
#           + Restart
#           + Restart FW
#           + Power Off
#       + Calibration
#           + Preheat: 
#              + Preheat all      
#              + Preheat hotend   
#              + Preheat hotbed   
#           + Home All
#           + Bed Mesh            
#           + Z Tilt 
#           + PID tuning
#              + Tune Hotend PID
#              + Tune Hotbed PID
#           + Z ENDSTOP CALIBRATE
#           + PROBE CALIBRATE
#           + Save config
#       + Language
#           + English
#           + Cestina
#           + Deutsch
#       + Filament sensor
#           + Extension: ON/OFF
#           + Distance: 930mm
#       + Display knob
#           + Feedback: ON/OFF


##############################################################
##    Menu:                                                  #
##############################################################

[menu __content] 
type: list
name: {{1: "Main Menu",
        2: "Hlavni nabidka",
        3: "Hauptmenu"}.get(printer.save_variables.variables.lang, "Main Menu")}


##############################################################
##    Menu - Adjust print                                    #
##############################################################

[menu __content __tune]
type: list
enable: {printer.idle_timeout.state == "Printing"}
name: {{1: "Adjust print", 2: "Doladeni tisku", 3: "Feineinstell."}.get(printer.save_variables.variables.lang, "Adjust print")}

[menu __content __tune __hotend0_target]
type: input
name: {"Ext:%3.0f (%4.0f)~degrees~" % (menu.input, printer.extruder.temperature)}
index: 1
input: {printer.extruder.target}
input_min: 0
input_max: {printer.configfile.config.extruder.max_temp}
input_step: 1
gcode:
    knob_feedback
    M104 T0 S{'%.0f' % menu.input}

[menu __content __tune __hotbed_target]
type: input
name: {"Bed:%3.0f (%4.0f)~degrees~" % (menu.input, printer.heater_bed.temperature)}
index: 2
input: {printer.heater_bed.target}
input_min: 0
input_max: {printer.configfile.config.heater_bed.max_temp}
input_step: 1
gcode:
    knob_feedback
    M140 S{'%.0f' % menu.input}

[menu __content __tune __speed]
type: input
name: {{1: "Speed", 2: "Rychlost", 3: "Geschw."}.get(printer.save_variables.variables.lang, "Speed")} {'%3d' % (menu.input*100)}%
input: {printer.gcode_move.speed_factor}
input_min: 0.01
input_max: 5
input_step: 0.01
realtime: True
gcode:
    knob_feedback
    M220 S{'%d' % (menu.input*100)}

[menu __content __tune __flow]
type: input
name: {{1: "Flow", 2: "Prutok", 3: "Fluss"}.get(printer.save_variables.variables.lang, "Flow")} {'%3d' % (menu.input*100)}%
input: {printer.gcode_move.extrude_factor}
input_min: 0.01
input_max: 2
input_step: 0.01
realtime: True
gcode:
    knob_feedback
    M221 S{'%d' % (menu.input*100)}

[menu __content __tune __offsetz]
type: input
name: {{1: "Offset Z:", 2: "Z offset", 3: "Offset Z:"}.get(printer.save_variables.variables.lang, "Offset Z")} {'%05.3f' % menu.input}
input: {printer.gcode_move.homing_origin.z}
input_min: -5
input_max: 5
input_step: 0.005
realtime: True
gcode:
    knob_feedback
    SET_GCODE_OFFSET Z={'%.3f' % menu.input} MOVE=1

[menu __content __tune __fanspeed]
type: input
name: {{1: "Fan speed:", 2: "Ventilator:", 3: "Lufter tempo:"}.get(printer.save_variables.variables.lang, "Fan speed")} {'%3d' % (menu.input*100)}%
input: {printer.fan.speed}
input_min: 0
input_max: 1
input_step: 0.01
gcode:
    knob_feedback
    M106 S{'%d' % (menu.input*255)}

	
##############################################################
##    Menu - SD print                                        #
##############################################################

[menu __content __sdcard]
type: vsdlist
enable: {('virtual_sdcard' in printer)}
name: {{1: "SD print", 2: "SD Tisk", 3: "SD-Druck"}.get(printer.save_variables.variables.lang, "SD print")}

[menu __content __sdcard __start]
type: command
enable: {('virtual_sdcard' in printer) and printer.virtual_sdcard.file_path and not printer.virtual_sdcard.is_active}
name: {{1: "Start printing", 2: "Zahajit tisk", 3: "Druck starten"}.get(printer.save_variables.variables.lang, "Start printing")}
gcode:
    knob_feedback
    M24

[menu __content __sdcard __resume]
type: command
enable: {('virtual_sdcard' in printer) and printer.print_stats.state == "paused"}
name: {{1: "Resume printing", 2: "Obnovit tisk", 3: "Druck fortset."}.get(printer.save_variables.variables.lang, "Resume printing")}
gcode:
    knob_feedback
    {% if "pause_resume" in printer %}
       RESUME
    {% else %}
       M24
    {% endif %}

[menu __content __sdcard __pause]
type: command
enable: {('virtual_sdcard' in printer) and printer.print_stats.state == "printing"}
name: {{1: "Pause printing", 2: "Pauza tisku", 3: "Druck pausieren"}.get(printer.save_variables.variables.lang, "Pause printing")}
gcode:
    knob_feedback
    {% if "pause_resume" in printer %}
       PAUSE
    {% else %}
       M25
    {% endif %}

[menu __content __sdcard __cancel]
type: command
enable: {('virtual_sdcard' in printer) and (printer.print_stats.state == "printing" or printer.print_stats.state == "paused")}
name: {{1: "Cancel printing", 2: "Zrusit tisk", 3: "Druck abbrechen"}.get(printer.save_variables.variables.lang, "Cancel printing")}
gcode:
    knob_feedback
    {% if 'pause_resume' in printer %}
       CANCEL_PRINT
    {% else %}
       M25
       M27
       M26 S0
       TURN_OFF_HEATERS
       {% if printer.toolhead.position.z <= printer.toolhead.axis_maximum.z - 5 %}
          G91
          G0 Z5 F1000
          G90
       {% endif %}
    {% endif %}


##############################################################
##    Menu - Control                                        #
##############################################################

[menu __content __control]
type: list
name: {{1: "Control", 2: "Ovladani", 3: "Steuerung"}.get(printer.save_variables.variables.lang, "Control")}

[menu __content __control __move]
type: list
enable: {not printer.idle_timeout.state == "Printing"}
name: {{1: "Move XYZ,E", 2: "Pohyb XYZ,E", 3: "Bewegen XYZ,E"}.get(printer.save_variables.variables.lang, "Move XYZ,E")}
index: 0

[menu __content __control __move __move10mm]
type: list
enable: {not printer.idle_timeout.state == "Printing"}
name: {{1: "Move 10mm", 2: "Pohyb o 10mm", 3: "10mm bewegen"}.get(printer.save_variables.variables.lang, "Move 10mm")}

[menu __content __control __move __move10mm __axis_x]
type: input
name: {{1: "Move X:", 2: "Pohyb X:", 3: "X bewegen:"}.get(printer.save_variables.variables.lang, "Move X:")} {'%05.1f' % menu.input}
input: {printer.gcode_move.gcode_position.x}
input_min: {printer.toolhead.axis_minimum.x}
input_max: {printer.toolhead.axis_maximum.x}
input_step: 10.0
gcode:
    knob_feedback
    SAVE_GCODE_STATE NAME=__move__axis
    G90
    G1 X{menu.input}
    RESTORE_GCODE_STATE NAME=__move__axis

[menu __content __control __move __move10mm __axis_y]
type: input
name: {{1: "Move Y:", 2: "Pohyb Y:", 3: "Y bewegen:"}.get(printer.save_variables.variables.lang, "Move Y:")} {'%05.1f' % menu.input}
input: {printer.gcode_move.gcode_position.y}
input_min: {printer.toolhead.axis_minimum.y}
input_max: {printer.toolhead.axis_maximum.y}
input_step: 10.0
gcode:
    knob_feedback
    SAVE_GCODE_STATE NAME=__move__axis
    G90
    G1 Y{menu.input}
    RESTORE_GCODE_STATE NAME=__move__axis

[menu __content __control __move __move10mm __axis_z]
type: input
enable: {not printer.idle_timeout.state == "Printing"}
name: {{1: "Move Z:", 2: "Pohyb Z:", 3: "Z bewegen:"}.get(printer.save_variables.variables.lang, "Move Z:")} {'%05.1f' % menu.input}
input: {printer.gcode_move.gcode_position.z}
input_min: 0
input_max: {printer.toolhead.axis_maximum.z}
input_step: 10.0
gcode:
    knob_feedback 
    SAVE_GCODE_STATE NAME=__move__axis
    G90
    G1 Z{menu.input} F720
    RESTORE_GCODE_STATE NAME=__move__axis

[menu __content __control __move __move10mm __axis_e]
type: input
enable: {not printer.idle_timeout.state == "Printing"}
name: {{1: "Move E:", 2: "Pohyb E:", 3: "E bewegen:"}.get(printer.save_variables.variables.lang, "Move E:")} {'%+06.1f' % menu.input}
input: 0
input_min: -{printer.configfile.config.extruder.max_extrude_only_distance|default(50)}
input_max: {printer.configfile.config.extruder.max_extrude_only_distance|default(50)}
input_step: 10.0
gcode:
    knob_feedback
    SAVE_GCODE_STATE NAME=__move__axis
    M83
    G1 E{menu.input} F240
    RESTORE_GCODE_STATE NAME=__move__axis

[menu __content __control __move __move1mm]
type: list
enable: {not printer.idle_timeout.state == "Printing"}
name: {{1: "Move 1mm", 2: "Pohyb o 1mm", 3: "1mm bewegen"}.get(printer.save_variables.variables.lang, "Move 1mm")}

[menu __content __control __move __move1mm __axis_x]
type: input
name: {{1: "Move X:", 2: "Pohyb X:", 3: "X bewegen:"}.get(printer.save_variables.variables.lang, "Move X:")} {'%05.1f' % menu.input}
input: {printer.gcode_move.gcode_position.x}
input_min: {printer.toolhead.axis_minimum.x}
input_max: {printer.toolhead.axis_maximum.x}
input_step: 1.0
gcode:
    knob_feedback
    SAVE_GCODE_STATE NAME=__move__axis
    G90
    G1 X{menu.input}
    RESTORE_GCODE_STATE NAME=__move__axis

[menu __content __control __move __move1mm __axis_y]
type: input
name: {{1: "Move Y:", 2: "Pohyb Y:", 3: "Y bewegen:"}.get(printer.save_variables.variables.lang, "Move Y:")} {'%05.1f' % menu.input}
input: {printer.gcode_move.gcode_position.y}
input_min: {printer.toolhead.axis_minimum.y}
input_max: {printer.toolhead.axis_maximum.y}
input_step: 1.0
gcode:
    knob_feedback
    SAVE_GCODE_STATE NAME=__move__axis
    G90
    G1 Y{menu.input}
    RESTORE_GCODE_STATE NAME=__move__axis

[menu __content __control __move __move1mm __axis_z]
type: input
enable: {not printer.idle_timeout.state == "Printing"}
name: {{1: "Move Z:", 2: "Pohyb Z:", 3: "Z bewegen:"}.get(printer.save_variables.variables.lang, "Move Z:")} {'%05.1f' % menu.input}
input: {printer.gcode_move.gcode_position.z}
input_min: 0
input_max: {printer.toolhead.axis_maximum.z}
input_step: 1.0
gcode:
    knob_feedback
    SAVE_GCODE_STATE NAME=__move__axis
    G90
    G1 Z{menu.input} F720
    RESTORE_GCODE_STATE NAME=__move__axis

[menu __content __control __move __move1mm __axis_e]
type: input
enable: {not printer.idle_timeout.state == "Printing"}
name: {{1: "Move E:", 2: "Pohyb E:", 3: "E bewegen:"}.get(printer.save_variables.variables.lang, "Move E:")} {'%+06.1f' % menu.input}
input: 0
input_min: -{printer.configfile.config.extruder.max_extrude_only_distance|default(50)}
input_max: {printer.configfile.config.extruder.max_extrude_only_distance|default(50)}
input_step: 1.0
gcode:
    knob_feedback
    SAVE_GCODE_STATE NAME=__move__axis
    M83
    G1 E{menu.input} F240
    RESTORE_GCODE_STATE NAME=__move__axis

[menu __content __control __move __move01mm]
type: list
enable: {not printer.idle_timeout.state == "Printing"}
name: {{1: "Move 0.1mm", 2: "Pohyb o 0.1mm", 3: "0.1mm bewegen"}.get(printer.save_variables.variables.lang, "Move 0.1mm")}

[menu __content __control __move __move01mm __axis_x]
type: input
name: {{1: "Move X:", 2: "Pohyb X:", 3: "X bewegen:"}.get(printer.save_variables.variables.lang, "Move X:")} {'%05.1f' % menu.input}
input: {printer.gcode_move.gcode_position.x}
input_min: {printer.toolhead.axis_minimum.x}
input_max: {printer.toolhead.axis_maximum.x}
input_step: 0.1
gcode:
    knob_feedback
    SAVE_GCODE_STATE NAME=__move__axis
    G90
    G1 X{menu.input}
    RESTORE_GCODE_STATE NAME=__move__axis

[menu __content __control __move __move01mm __axis_y]
type: input
name: {{1: "Move Y:", 2: "Pohyb Y:", 3: "Y bewegen:"}.get(printer.save_variables.variables.lang, "Move Y:")} {'%05.1f' % menu.input}
input: {printer.gcode_move.gcode_position.y}
input_min: {printer.toolhead.axis_minimum.y}
input_max: {printer.toolhead.axis_maximum.y}
input_step: 0.1
gcode:
    knob_feedback
    SAVE_GCODE_STATE NAME=__move__axis
    G90
    G1 Y{menu.input}
    RESTORE_GCODE_STATE NAME=__move__axis

[menu __content __control __move __move01mm __axis_z]
type: input
enable: {not printer.idle_timeout.state == "Printing"}
name: {{1: "Move Z:", 2: "Pohyb Z:", 3: "Z bewegen:"}.get(printer.save_variables.variables.lang, "Move Z:")} {'%05.1f' % menu.input}
input: {printer.gcode_move.gcode_position.z}
input_min: 0
input_max: {printer.toolhead.axis_maximum.z}
input_step: 0.1
gcode:
    knob_feedback
    SAVE_GCODE_STATE NAME=__move__axis
    G90
    G1 Z{menu.input} F720
    RESTORE_GCODE_STATE NAME=__move__axis

[menu __content __control __move __move01mm __axis_e]
type: input
enable: {not printer.idle_timeout.state == "Printing"}
name: {{1: "Move E:", 2: "Pohyb E:", 3: "E bewegen:"}.get(printer.save_variables.variables.lang, "Move E:")} {'%+06.1f' % menu.input}
input: 0
input_min: -{printer.configfile.config.extruder.max_extrude_only_distance|default(50)}
input_max: {printer.configfile.config.extruder.max_extrude_only_distance|default(50)}
input_step: 0.1
gcode:
    knob_feedback
    SAVE_GCODE_STATE NAME=__move__axis
    M83
    G1 E{menu.input} F240
    RESTORE_GCODE_STATE NAME=__move__axis

# Home:
[menu __content __control __home]
type: command
enable: {not printer.idle_timeout.state == "Printing"}
name: {{1: "Home All", 2: "Domu vse", 3: "Home Alle"}.get(printer.save_variables.variables.lang, "Home All")}
index: 2
gcode:
    knob_feedback
    G28 X Y
    G28 Z

[menu __content __control __homexy]
type: command
enable: {not printer.idle_timeout.state == "Printing"}
name: {{1: "Home XY", 2: "Domu XY", 3: "Home XY"}.get(printer.save_variables.variables.lang, "Home XY")}
index: 3
gcode:
    knob_feedback
    G28 X Y

[menu __content __control __home_z]
type: command
enable: {not printer.idle_timeout.state == "Printing"}
name: {{1: "Home Z", 2: "Domu Z", 3: "Home Z"}.get(printer.save_variables.variables.lang, "Home Z")}
index: 4
gcode:
    knob_feedback
    G28 Z

# Park toolhead
[menu __content __control __park]
type: command
enable: {not printer.idle_timeout.state == "Printing"}
index: 5
name: {{1: "Park toolhead", 2: "Zaparkovat", 3: "Werkzeugpark"}.get(printer.save_variables.variables.lang, "Park toolhead")}
gcode:
    knob_feedback
    Park_Toolhead

# Steppers Off
[menu __content __control __disable]
type: command
enable: {not printer.idle_timeout.state == "Printing"}
index: 6
name: {{1: "Steppers off", 2: "Vypnout motory", 3: "Motoren aus"}.get(printer.save_variables.variables.lang, "Steppers off")}
gcode:
    knob_feedback
    steppers_off

# E Stepper off:
[menu __content __control __estepperoff]
type: command
enable: {not printer.idle_timeout.state == "Printing"}
name: {{1: "E Stepper off", 2: "Vypnout E motor", 3: "E Motor aus"}.get(printer.save_variables.variables.lang, "E Stepper off")}
index: 7
gcode:
    knob_feedback
    e_stepper_off

# Fans
[menu __content __control __fanonoff]
type: input
enable: {'fan' in printer}
index: 8
name: {{1: "Fan:", 2: "Ventilator:", 3: "Lufter:"}.get(printer.save_variables.variables.lang, "Fan:")} {'ON ' if menu.input else 'OFF'}
input: {printer.fan.speed}
input_min: 0
input_max: 1
input_step: 1
gcode:
    knob_feedback
    M106 S{255 if menu.input else 0}

[menu __content __control __fanspeed]
type: input
enable: {'fan' in printer}
index: 9
name: {{1: "Fan speed:", 2: "Ventilator:", 3: "Lufter tempo:"}.get(printer.save_variables.variables.lang, "Fan speed:")} {'%2d' % (menu.input*100)}%
input: {printer.fan.speed}
input_min: 0
input_max: 1
input_step: 0.01
gcode:
    knob_feedback
    M106 S{'%d' % (menu.input*255)}


##############################################################
##    Menu - Temperature                                     #
##############################################################

[menu __content __temp]
type: list
name: {{1: "Temperature", 2: "Teplota", 3: "Temperatur"}.get(printer.save_variables.variables.lang, "Temperature")}
enable: {not printer.idle_timeout.state == "Printing"}

[menu __content __temp __hotend0_target]
type: input
enable: {('extruder' in printer) and ('extruder' in printer.heaters.available_heaters)}
name: {"Ext:%3.0f (%4.0f)~degrees~" % (menu.input, printer.extruder.temperature)}
input: {printer.extruder.target}
input_min: 0
input_max: {printer.configfile.config.extruder.max_temp}
input_step: 1
gcode:
    knob_feedback
    M104 T0 S{'%.0f' % menu.input}

[menu __content __temp __hotbed_target]
type: input
enable: {'heater_bed' in printer}
name: {"Bed:%3.0f (%4.0f)~degrees~" % (menu.input, printer.heater_bed.temperature)}
input: {printer.heater_bed.target}
input_min: 0
input_max: {printer.configfile.config.heater_bed.max_temp}
input_step: 1
gcode:
    knob_feedback
    M140 S{'%.0f' % menu.input}

# Preheat PLA:
[menu __content __temp __preheat_pla]
type: list
name: {{1: "Preheat PLA", 2: "Predehrat PLA", 3: "PLA vorheizen"}.get(printer.save_variables.variables.lang, "Preheat PLA")}

[menu __content __temp __preheat_pla __all]
type: command
enable: {('extruder' in printer) and ('heater_bed' in printer)}
name: {{1: "Preheat all", 2: "Predehrat vse", 3: "Alles vorheizen"}.get(printer.save_variables.variables.lang, "Preheat all")}
gcode:
    knob_feedback
    M140 S50
    M104 S200
    {menu.exit()}

[menu __content __temp __preheat_pla __hotend]
type: command
enable: {'extruder' in printer}
name: Hotend: 200~degrees~C
gcode:
    knob_feedback
    M104 S200
    {menu.exit()}

[menu __content __temp __preheat_pla __hotbed]
type: command
enable: {'heater_bed' in printer}
name: Bed:    50~degrees~C
gcode:
    knob_feedback
    M140 S50
    {menu.exit()}

# Preheat PETG:
[menu __content __temp __preheat_petg]
type: list
name: {{1: "Preheat PETG", 2: "Predehrat PETG", 3: "PETG vorheizen"}.get(printer.save_variables.variables.lang, "Preheat PETG")}
index: 4

[menu __content __temp __preheat_petg __all]
type: command
enable: {('extruder' in printer) and ('heater_bed' in printer)}
name: {{1: "Preheat all", 2: "Predehrat vse", 3: "Alles vorheizen"}.get(printer.save_variables.variables.lang, "Preheat all")}
gcode:
    knob_feedback
    M140 S60
    M104 S220
    {menu.exit()}

[menu __content __temp __preheat_petg __hotend]
type: command
enable: {'extruder' in printer}
name: Hotend: 220~degrees~C
gcode:
    knob_feedback
    M104 S220
    {menu.exit()}

[menu __content __temp __preheat_petg __hotbed]
type: command
enable: {'heater_bed' in printer}
name: Bed:    60~degrees~C
gcode:
    knob_feedback
    M140 S60
    {menu.exit()}

# Preheat ABS:
[menu __content __temp __preheat_abs]
type: list
name: {{1: "Preheat ABS", 2: "Predehrat ABS", 3: "ABS vorheizen"}.get(printer.save_variables.variables.lang, "Preheat ABS")}

[menu __content __temp __preheat_abs __all]
type: command
enable: {('extruder' in printer) and ('heater_bed' in printer)}
name: {{1: "Preheat all", 2: "Predehrat vse", 3: "Alles vorheizen"}.get(printer.save_variables.variables.lang, "Preheat all")}
gcode:
    knob_feedback
    M140 S80
    M104 S245
    {menu.exit()}

[menu __content __temp __preheat_abs __hotend]
type: command
enable: {'extruder' in printer}
name: Hotend: 245~degrees~C
gcode:
    knob_feedback
    M104 S245
    {menu.exit()}

[menu __content __temp __preheat_abs __hotbed]
type: command
enable: {'heater_bed' in printer}
name: Bed:    80~degrees~C
gcode:
    knob_feedback
    M140 S80
    {menu.exit()}

# Preheat PROBE:
[menu __content __temp __preheat_probe]
type: list
name: {{1: "Preheat PROBE", 2: "Predehrat PROBE", 3: "PROBE vorheizen"}.get(printer.save_variables.variables.lang, "Preheat PROBE")}
index: 6

[menu __content __temp __preheat_probe __all]
type: command
enable: {('extruder' in printer) and ('heater_bed' in printer)}
name: {{1: "Preheat all", 2: "Predehrat vse", 3: "Alles vorheizen"}.get(printer.save_variables.variables.lang, "Preheat all")}
gcode:
    knob_feedback
    M140 S50
    M104 S150
    {menu.exit()}

[menu __content __temp __preheat_probe __hotend]
type: command
enable: {'extruder' in printer}
name: Hotend: 150~degrees~C
gcode:
    knob_feedback
    M104 S150
    {menu.exit()}

[menu __content __temp __preheat_probe __hotbed]
type: command
enable: {'heater_bed' in printer}
name: Bed:    50~degrees~C
gcode:
    knob_feedback
    M140 S50
    {menu.exit()}

# COOLDOWN:
[menu __content __temp __cooldown]
type: list
name: {{1: "Cooldown", 2: "Vyp. ohrev", 3: "Abkuhlen"}.get(printer.save_variables.variables.lang, "Cooldown")}

[menu __content __temp __cooldown __all]
type: command
enable: {('extruder' in printer) and ('heater_bed' in printer)}
name: {{1: "Cooldown all", 2: "Vypnout vse", 3: "Alles abkuhlen"}.get(printer.save_variables.variables.lang, "Cooldown all")}
gcode:
    knob_feedback
    M104 S0
    M140 S0
    {menu.exit()}

[menu __content __temp __cooldown __hotend]
type: command
enable: {'extruder' in printer}
name: {{1: "Hotend off", 2: "Vyp. hotend", 3: "Hotend AUS"}.get(printer.save_variables.variables.lang, "Hotend off")}
gcode:
    knob_feedback
    M104 S0
    {menu.exit()}

[menu __content __temp __cooldown __hotbed]
type: command
enable: {'heater_bed' in printer}
name: {{1: "Hotbed off", 2: "Vyp. hotbed", 3: "Bett AUS"}.get(printer.save_variables.variables.lang, "Hotbed off")}
gcode:
    knob_feedback
    M140 S0
    {menu.exit()}

	   
##############################################################
##    Menu - Filament                                        #
##############################################################

[menu __content __filament]
type: list
name: {{1: "Filament", 2: "Filament", 3: "Filament"}.get(printer.save_variables.variables.lang, "Filament")}
enable: {not printer.idle_timeout.state == "Printing"}

[menu __content __filament __hotend0_target]
type: input
enable: {'extruder' in printer}
name: {"Ext:%3.0f (%4.0f)~degrees~" % (menu.input, printer.extruder.temperature)}
index: 0
input: {printer.extruder.target}
input_min: 0
input_max: {printer.configfile.config.extruder.max_temp}
input_step: 1
gcode:
    knob_feedback
    M104 T0 S{'%.0f' % menu.input}

# LOAD
[menu __content __filament __load]
type: list
name: {{1: "Load filament", 2: "Nacist fil.", 3: "Filament laden"}.get(printer.save_variables.variables.lang, "Load filament")}
enable: True
index: 1

[menu __content __filament __load _pla]
type: command
name: {{1: "Load PLA", 2: "Nacist PLA", 3: "PLA laden"}.get(printer.save_variables.variables.lang, "Load PLA")}
gcode:
    knob_feedback
    SAVE_GCODE_STATE NAME=__filament__load
    {% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
       _TOOLHEAD_PARK_PAUSE_CANCEL
       M109 S200
       M83
       G1 E50 F240
    {% else %}
       M109 S200
       M83
       G1 E50 F240 
    {% endif %}
    RESTORE_GCODE_STATE NAME=__filament__load

[menu __content __filament __load _petg]
type: command
name: {{1: "Load PETG", 2: "Nacist PETG", 3: "PETG laden"}.get(printer.save_variables.variables.lang, "Load PETG")}
gcode:
    knob_feedback
    SAVE_GCODE_STATE NAME=__filament__load
    {% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
       _TOOLHEAD_PARK_PAUSE_CANCEL
       M109 S220
       M83
       G1 E50 F240
    {% else %}
       M109 S220
       M83
       G1 E50 F240 
    {% endif %}
    RESTORE_GCODE_STATE NAME=__filament__load

[menu __content __filament __load _abs]
type: command
name: {{1: "Load ABS", 2: "Nacist ABS", 3: "ABS laden"}.get(printer.save_variables.variables.lang, "Load ABS")}
gcode:
    knob_feedback
    SAVE_GCODE_STATE NAME=__filament__load
    {% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
       _TOOLHEAD_PARK_PAUSE_CANCEL
       M109 S245
       M83
       G1 E50 F240
    {% else %}
       M109 S245
       M83
       G1 E50 F240 
    {% endif %}
    RESTORE_GCODE_STATE NAME=__filament__load

# UNLOAD
[menu __content __filament __unload]
type: list
name: {{1: "Unload filament", 2: "Vyjmout fil.", 3: "Fil. entladen"}.get(printer.save_variables.variables.lang, "Unload filament")}
enable: True
index: 2

[menu __content __filament __unload _pla]
type: command
name: {{1: "Unload PLA", 2: "Vyjmout PLA", 3: "PLA entladen"}.get(printer.save_variables.variables.lang, "Unload PLA")}
gcode:
    knob_feedback
    SAVE_GCODE_STATE NAME=__filament__unload
    {% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
       _TOOLHEAD_PARK_PAUSE_CANCEL
       M109 S200
       M83
       G1 E-70 F300
    {% else %}
       M109 S200
       M83
       G1 E-70 F300 
    {% endif %}
    RESTORE_GCODE_STATE NAME=__filament__unload   
	
[menu __content __filament __unload _petg]
type: command
name: {{1: "Unload PETG", 2: "Vyjmout PETG", 3: "PETG entladen"}.get(printer.save_variables.variables.lang, "Unload PETG")}
gcode:
    knob_feedback
    SAVE_GCODE_STATE NAME=__filament__unload
    {% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
       _TOOLHEAD_PARK_PAUSE_CANCEL
       M109 S220
       M83
       G1 E-70 F300
    {% else %}
       M109 S220
       M83
       G1 E-70 F300 
    {% endif %}
    RESTORE_GCODE_STATE NAME=__filament__unload   
	
[menu __content __filament __unload _abs]
type: command
name: {{1: "Unload ABS", 2: "Vyjmout ABS", 3: "ABS entladen"}.get(printer.save_variables.variables.lang, "Unload ABS")}
gcode:
    knob_feedback
    SAVE_GCODE_STATE NAME=__filament__unload
    {% if printer.idle_timeout.state == "Idle" or printer.idle_timeout.state == "Ready" %}
       _TOOLHEAD_PARK_PAUSE_CANCEL
       M109 S245
       M83
       G1 E-70 F300
    {% else %}
       M109 S245
       M83
       G1 E-70 F300 
    {% endif %}
    RESTORE_GCODE_STATE NAME=__filament__unload 

# Filament Change
[menu __content __filament __M600]
type: list
enable: True 
name: {{1: "Change Filament", 2: "Vymenit fil.", 3: "Fil. wechseln"}.get(printer.save_variables.variables.lang, "Change Filament")}
index: 3

[menu __content __filament __M600 __plaM600]
type: command
enable: True 
name: {{1: "Change PLA", 2: "Vymenit PLA", 3: "PLA wechseln"}.get(printer.save_variables.variables.lang, "Change PLA")}
gcode:
    knob_feedback
    SAVE_GCODE_STATE NAME=__filament__m600
    M109 S200
    M600
    RESTORE_GCODE_STATE NAME=__filament__m600
    
[menu __content __filament __M600 __petgM600]
type: command
enable: True 
name: {{1: "Change PETG", 2: "Vymenit PETG", 3: "PETG wechseln"}.get(printer.save_variables.variables.lang, "Change PETG")}
gcode:
    knob_feedback
    SAVE_GCODE_STATE NAME=__filament__m600
    M109 S220
    M600
    RESTORE_GCODE_STATE NAME=__filament__m600
    
[menu __content __filament __M600 __absM600]
type: command
enable: True 
name: {{1: "Change ABS", 2: "Vymenit ABS", 3: "ABS wechseln"}.get(printer.save_variables.variables.lang, "Change ABS")}
gcode:
    knob_feedback
    SAVE_GCODE_STATE NAME=__filament__m600
    M109 S245
    M600
    RESTORE_GCODE_STATE NAME=__filament__m600

# E MOVE
[menu __content __filament __feed]
type: input
name: {{1: "Move E:", 2: "E Posun:", 3: "E bewegen:"}.get(printer.save_variables.variables.lang, "Move E:")} {'%.1f' % menu.input} mm
index: 4
input: 5
input_step: 0.1
gcode:
    knob_feedback
    SAVE_GCODE_STATE NAME=__filament__load
    M83
    G1 E{'%.1f' % menu.input} F60
    RESTORE_GCODE_STATE NAME=__filament__load

# E Stepper Off
[menu __content __filament __estepperoff]
type: command
enable: True 
name: {{1: "E Stepper off", 2: "Vyp. E motor", 3: "E motor aus"}.get(printer.save_variables.variables.lang, "E Stepper off")}
gcode:
    knob_feedback
    e_stepper_off


##############################################################
##    Menu - lights                                          #
##############################################################

[menu __content __lights]
type: list
enable: True  
name: {{1: "Lights", 2: "Svetla", 3: "Licht"}.get(printer.save_variables.variables.lang, "Lights")}
index: 6

[menu __content __lights __lightsonoff]
type: input
enable: True
index: 1
name: {{1: "Lights:", 2: "Svetla:", 3: "Licht:"}.get(printer.save_variables.variables.lang, "Lights:")} {'ON ' if menu.input else 'OFF'}
input: {printer.save_variables.variables.lights_onoff | int}
input_min: 0
input_max: 1
input_step: 1
gcode:
    knob_feedback  
    {% set onoff = menu.input | int %}
    {% if onoff == 1 %} lights_on {% else %} lights_off {% endif %}

[menu __content __lights __lightsbright]
type: input
enable: True
index: 2
name: {{1: "Bright:", 2: "Jas:", 3: "Helligkeit:"}.get(printer.save_variables.variables.lang, "Bright:")} {'%2d' %(menu.input*100)}%
input: {printer.save_variables.variables.lights_white | float | round(1)}
input_min: 0.0
input_max: 1.0
input_step: 0.1
gcode:
    knob_feedback
    {% set white = menu.input | float | round(1) %}
    SET_LED LED=lights RED={white} GREEN={white} BLUE={white} TRANSMIT=1 SYNC=0 

[menu __content __lights __max]
type: command
enable: True
index: 3
name: {{1: "Bright on max", 2: "Jas na max", 3: "Licht max."}.get(printer.save_variables.variables.lang, "Bright on max")}
gcode:
    knob_feedback
    lights_max

[menu __content __lights __exturderonoff]
type: input
enable: True
index: 4
name: {{1: "Nozzle:", 2: "Tryska:", 3: "Duse:"}.get(printer.save_variables.variables.lang, "Nozzle:")} {'ON ' if menu.input else 'OFF'}
input: {printer.save_variables.variables.extruder_onoff | int}
input_min: 0
input_max: 1
input_step: 1
gcode:
    knob_feedback  
    {% set onoff = menu.input | int %}
    {% if onoff == 1 %} nozzle_led_on {% else %} nozzle_led_off {% endif %}

[menu __content __lights __lights_red]
type: input
enable: True
index: 5
name: {{1: "Red:", 2: "Red:", 3: "Rot:"}.get(printer.save_variables.variables.lang, "Red:")} {'%1.2f' %(menu.input)}
input: {printer.save_variables.variables.lights_red | float | round(2)}
input_min: 0.00
input_max: 1.00
input_step: 0.01
gcode:
    knob_feedback
    {% set red = menu.input | float | round(2) %}           
    SET_LED LED=lights RED={ red }
	
[menu __content __lights __lights_green]
type: input
enable: True
index: 6
name: {{1: "Green:", 2: "Green:", 3: "Grun:"}.get(printer.save_variables.variables.lang, "Green:")} {'%1.2f' %(menu.input)}
input: {printer.save_variables.variables.lights_green | float | round(2)}
input_min: 0.00
input_max: 1.00
input_step: 0.01
gcode:
    knob_feedback
    {% set green = menu.input | float | round(2) %}
    SET_LED LED=lights GREEN={ green }
	
[menu __content __lights __lights_blue]
type: input
enable: True
index: 7
name: {{1: "Blue:", 2: "Blue:", 3: "Blau:"}.get(printer.save_variables.variables.lang, "Blue:")} {'%1.2f' %(menu.input)}
input: {printer.save_variables.variables.lights_blue | float | round(2)}
input_min: 0.00
input_max: 1.00
input_step: 0.01
gcode:
    knob_feedback
    {% set blue = menu.input | float | round(2) %}
    SET_LED LED=lights BLUE={ blue }


##############################################################
##    Chamber:                                               #
##############################################################

[menu __content __chamber]
type: list
enable: True 
name: {{1: "Chamber", 2: "Komora", 3: "Kammer"}.get(printer.save_variables.variables.lang, "Chamber")}
index: 7

[menu __content __chamber __chamber_temp]
type: command
name: {{1: "Current:", 
        2: "Aktualne:", 
        3: "Aktuell:" }.get(printer.save_variables.variables.lang, "Current")} {'%2.0f' % (printer['temperature_fan Chamber'].temperature)}~degrees~C
gcode:

[menu __content __chamber __target_temp]
type: input
name: {{1: "Cooling:", 2: "Chlazeni:", 3: "Cool bei:"}.get(printer.save_variables.variables.lang, "Cooling:")} {'%2.0f' % (menu.input)}~degrees~C
input: {printer['temperature_fan Chamber'].target}
input_min: 15
input_max: 70
input_step: 1
gcode:
    knob_feedback
    M141 S{'%.0f' % menu.input}


##############################################################
##    Menu - SETUP                                           #
##############################################################

[menu __content __setup]
type: list
enable: True
name: {{1: "Setup", 2: "Nastaveni", 3: "Einstellungen"}.get(printer.save_variables.variables.lang, "Setup")}
index: 8

[menu __content __setup __restart]
type: list
enable: {not (printer.print_stats.state == "printing" or printer.print_stats.state == "paused")}
name: {{1: "Power Manag.", 2: "Napajeni", 3: "Energie"}.get(printer.save_variables.variables.lang, "Power Manag.")}

[menu __content __setup __restart __host_restart]
type: command
enable: {not printer.idle_timeout.state == "Printing"}
name: {{1: "Restart", 2: "Restartovat", 3: "Neustart"}.get(printer.save_variables.variables.lang, "Restart")}
gcode:
    knob_feedback
    RESTART

[menu __content __setup __restart __firmware_restart]
type: command
enable: {not printer.idle_timeout.state == "Printing"}
name: {{1: "Restart FW", 2: "Restart FW", 3: "FW Neustart"}.get(printer.save_variables.variables.lang, "Restart FW")}
gcode:
    knob_feedback
    FIRMWARE_RESTART

[menu __content __setup __restart __power_off] 
type: command
enable: {not (printer.print_stats.state == "printing" or printer.print_stats.state == "paused") and 'gcode_macro _POWER_OFF_PRINTER' in printer}
name: {{1: "Power Off", 2: "Vypnout", 3: "Ausschalten"}.get(printer.save_variables.variables.lang, "Power Off")}
gcode:
    knob_feedback
    {menu.exit()} _POWER_OFF_PRINTER

## Calibration:
[menu __content __setup __calib]
type: list
enable: {not (printer.print_stats.state == "printing" or printer.print_stats.state == "paused")}
name: {{1: "Calibration", 2: "Kalibrace", 3: "Kalibrierung"}.get(printer.save_variables.variables.lang, "Calibration")}

# Preheat:
[menu __content __setup __calib __preheat]
type: list
name: {{1: "Preheat", 2: "Predehrat", 3: "Vorheizen"}.get(printer.save_variables.variables.lang, "Preheat")}
index: 1

[menu __content __setup __calib __preheat __all]
type: command
enable: {('extruder' in printer) and ('heater_bed' in printer)}
name: {{1: "Preheat all", 2: "Predehrat vse", 3: "Alles vorheizen"}.get(printer.save_variables.variables.lang, "Preheat all")}
gcode:
    knob_feedback
    M140 S50
    M104 S150

[menu __content __setup __calib __preheat __hotend]
type: command
enable: {'extruder' in printer}
name: Hotend: 150~degrees~C
gcode:
    knob_feedback
    M104 S150

[menu __content __setup __calib __preheat __hotbed]
type: command
enable: {'heater_bed' in printer}
name: Bed:    50~degrees~C
gcode:
    knob_feedback
    M140 S50

# Home All:
[menu __content __setup __calib __home]
type: command
enable: {not printer.idle_timeout.state == "Printing"}
name: {{1: "Home All", 2: "Domu vse", 3: "Home Alle"}.get(printer.save_variables.variables.lang, "Home All")}
index: 2
gcode:
    knob_feedback
    G28 X Y
    G28 Z

# Z TILT:
[menu __content __setup __calib __ztilt]
type: command
index: 3
enable: {not printer.idle_timeout.state == "Printing" and ('z_tilt' in printer)}
name: Z Tilt
gcode:
    knob_feedback
    Z_TILT_ADJUST

# Bed mesh
[menu __content __setup __calib __bedmesh]
type: command
index: 4
enable: {not printer.idle_timeout.state == "Printing" and ('bed_mesh' in printer)}
name: Bed Mesh
gcode:
    knob_feedback
    BED_MESH_CALIBRATE

# PID
[menu __content __setup __calib __tuning]
type: list
name: {{1: "PID tuning", 2: "PID kalibrace", 3: "PID-Kalibrier."}.get(printer.save_variables.variables.lang, "PID tuning")}
index: 5

[menu __content __setup __calib __tuning __hotend_pid_tuning]
type: command
enable: {(not printer.idle_timeout.state == "Printing") and ('extruder' in printer)}
name: Hotend PID
gcode:
    knob_feedback
    PID_CALIBRATE HEATER=extruder TARGET=200 WRITE_FILE=1

[menu __content __setup __calib __tuning __hotbed_pid_tuning]
type: command
enable: {(not printer.idle_timeout.state == "Printing") and ('heater_bed' in printer)}
name: Hotbed PID
gcode:
    knob_feedback
    PID_CALIBRATE HEATER=heater_bed TARGET=50 WRITE_FILE=1

# Z ENDSTOP CALIBRATE
[menu __content __setup __calib __z_endstop_calibrate]
type: command
index: 7
enable: {(not printer.idle_timeout.state == "Printing" or printer.print_stats.state == "paused")}
name: Z Endstop Calibrate
gcode:
    knob_feedback
    Z_ENDSTOP_CALIBRATE

# PROBE CALIBRATE
[menu __content __setup __calib __probe_calibrate]
type: command
index: 8
enable: {(not printer.idle_timeout.state == "Printing" or printer.print_stats.state == "paused")}
name: Probe Calibrate
gcode:
    knob_feedback
    PROBE_CALIBRATE 

# Save Config and Restart
[menu __content __setup __calib __saveconfig]
type: command
name: Save Config
index: 9
enable: {(not printer.idle_timeout.state == "Printing" or printer.print_stats.state == "paused")}
gcode:
    knob_feedback
    SAVE_CONFIG

# Language Change:
[menu __content __setup __language_selection]
type: list
name: {{1: "Language", 2: "Zmena jazyka", 3: "Sprache"}.get(printer.save_variables.variables.lang, "Language")}
index: 10

[menu __content __setup __language_selection __english]
type: command
name: English
gcode:
    knob_feedback
    SET_MENU_LANGUAGE LANGUAGE=1
    {menu.back()}

[menu __content __setup __language_selection __czech]
type: command
name: Cestina
gcode:
    knob_feedback
    SET_MENU_LANGUAGE LANGUAGE=2
    {menu.back()}

[menu __content __setup __language_selection __german]
type: command
name: Deutsch
gcode:
    knob_feedback
    SET_MENU_LANGUAGE LANGUAGE=3
    {menu.back()}

# Filament sensor - Runout Distance:
[menu __content __setup __filament_runout]
type: list
name: {{1: "Filament sens.", 2: "Senzor filam.", 3: "Filament sens."}.get(printer.save_variables.variables.lang, "Filament sens.")}
index: 11

[menu __content __setup __filament_runout __runout_distance_on_off]
type: input
index: 1
name: {{1: "Extension:", 2: "Dobeh:", 3: "Verzogert:"}.get(printer.save_variables.variables.lang, "Extension:")} {'ON ' if menu.input else 'OFF'}
input: {printer.save_variables.variables.runout_distance_on_off}
input_min: 0
input_max: 1
input_step: 1
gcode:
    knob_feedback
    SAVE_VARIABLE VARIABLE=runout_distance_on_off VALUE={ 1 if menu.input else 0 } 

[menu __content __setup __filament_runout __runout_distance]
type: input
name: {{1: "Distance:", 2: "Delka:", 3: "Distanz:"}.get(printer.save_variables.variables.lang, "Distance:")}{'%4d' % (menu.input)}mm
input: {printer.save_variables.variables.runout_distance}
input_min: 100
input_max: 2000
input_step: 10
gcode:
    knob_feedback   
    SAVE_VARIABLE VARIABLE=runout_distance VALUE={ '%.0f' % menu.input }

# Knob feedback change:
[menu __content __setup __knob]
type: list
name: {{1: "Display knob", 2: "Lcd kolecko", 3: "Anzeige Taste"}.get(printer.save_variables.variables.lang, "Display knob")}
index: 12

[menu __content __setup __knob __knob_onoff]
type: input
enable: True
name: {{1: "Feedback:", 2: "Led odezva:", 3: "Ruckmeld:"}.get(printer.save_variables.variables.lang, "Feedback:")} {'ON ' if menu.input else 'OFF'}
input: {printer.save_variables.variables.display_knob | int}
input_min: 0
input_max: 1
input_step: 1
gcode:
    {% set value_knob = printer.save_variables.variables.display_knob %}
    {% if value_knob == 0 %}
       SET_LED LED=display RED=0 GREEN=1 BLUE=0 INDEX=1 TRANSMIT=1 SKIP=1
       UPDATE_DELAYED_GCODE ID=display_knob_return DURATION=0.5  
    {% endif %} 
    {% set knob_onoff = menu.input | int %}
    SAVE_VARIABLE VARIABLE=display_knob VALUE={knob_onoff}


